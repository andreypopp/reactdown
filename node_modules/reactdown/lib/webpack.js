'use strict';

var _index = require('./index');

var _Config = require('./Config');

/**
 * Webpack loader for reactdown documents.
 */
/**
 * @copyright 2016-present, Reactdown Team
 * 
 */

function reactdown(source) {
  this.cacheable();

  var compiler = this._compiler;

  // We read the config once. That means on changes to config one must restart
  // the compiler.
  //
  // TODO: Improve on that, so changes to configration do not require restarting
  // Webpack compiler.
  if (compiler.__reactdownConfig === undefined) {
    compiler.__reactdownConfig = (0, _Config.findConfig)(compiler.context).config;
  }

  var config = (0, _Config.mergeConfig)(compiler.__reactdownConfig, (0, _Config.parseConfigFromQuery)(this.query));

  return (0, _index.renderToString)(source, config).code;
}

module.exports = reactdown;
